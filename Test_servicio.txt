
=========================
API Taller Mecánica - Endpoints
Puerto base: 4040
=========================

SERVICIO FACTURA
-------------------------
[POST]   http://localhost:4040/factura
Body (JSON):
{
  "OrdenTrabajoID": 1,
  "Subtotal": 100000,
  "IVA": 19000,
  "Total": 119000
}

[GET]    http://localhost:4040/factura/obtener/1

[PUT]    http://localhost:4040/factura/modificar/1
Body (JSON):
{
  "subtotal": 95000,
  "iva": 18050,
  "total": 113050
}

[DELETE] http://localhost:4040/factura/eliminar/1

****************************************************************************************************************************************
SERVICIO REPUESTO
-------------------------
[POST]   http://localhost:4040/repuesto
Body (JSON):
{
  "proveedor_id": 3,
  "nombre": "Filtro de aire",
  "descripcion": "Filtro de aire para motor 1.6",
  "precio_unitario": 35000,
  "stock_actual": 10
}

[GET]    http://localhost:4040/repuesto/4

[PUT]    http://localhost:4040/repuesto/3
Body (JSON):
{
  "proveedor_id": 3,
  "nombre": "Filtro de aire premium",
  "descripcion": "Filtro de aire reforzado",
  "precio_unitario": 40000,
  "stock_actual": 15
}

[DELETE] http://localhost:4040/repuesto/eliminar/1

************************************************************************************************************************************
SERVICIO SERVICIO (CATÁLOGO DE SERVICIOS)
-------------------------
[POST]   http://localhost:4040/servicio/crear
Body (JSON):
{
  "nombre": "Cambio de aceite",
  "descripcion": "Cambio de aceite sintético y revisión básica",
  "precio_base": 80000
}

[GET]    http://localhost:4040/servicio/obtener/1

[PUT]    http://localhost:4040/servicio/modificar/1
Body (JSON):
{
  "nombre": "Cambio de aceite + filtro",
  "descripcion": "Cambio de aceite premium con filtro nuevo",
  "precio_base": 95000
}

[DELETE] http://localhost:4040/servicio/eliminar/1

*********************************************************************************************************************************
SERVICIO CITA
-------------------------
[POST]   http://localhost:4040/cita
Body (JSON):
{
  "cliente_id": 2,
  "vehiculo_id": 14,
  "fecha_cita": "2025-12-01 10:30:00",
  "descripcion": "Test Token"
}

[GET]    http://localhost:4040/cita/cliente/<int:cliente_id>

[PUT]    http://localhost:4040/cita/<int:cita_id>/estado
Body (JSON):
{
  "estado": "Atendida"
}

[DELETE] http://localhost:4040/cita/<int:cita_id>

*********************************************************************************************************************************
SERVICIO PAGO
-------------------------
[POST]   http://localhost:4040/pago/crear
Body (JSON):
{
  "factura_id": 1,
  "monto": 119000,
  "metodo": "Tarjeta"
}

[GET]    http://localhost:4040/pago/obtener/1

[PUT]    http://localhost:4040/pago/actualizar/1
Body (JSON):
{
  "nuevo_monto": 120000,
  "nuevo_metodo": "Transferencia"
}

[DELETE] http://localhost:4040/pago/eliminar/1

*********************************************************************************************************************************

SERVICIO VEHICULO
-------------------------
[POST]   http://localhost:4040/vehiculo
Body (JSON):
{
  "cliente_id": 1,
  "placa": "ABC123",
  "marca": "Toyota",
  "modelo": "Corolla",
  "anio": 2020,
  "vin": "1HGCM82633A123456",
  "color": "Rojo"
}

[GET]    http://localhost:4040/vehiculo/13

[PUT]    http://localhost:4040/vehiculo/13
Body (JSON):
{
  "cliente_id": 1,
  "placa": "XYZ789",
  "marca": "Mazda",
  "modelo": "3",
  "anio": 2021,
  "vin": "1HGCM82633A654321",
  "color": "Negro"
}

[DELETE] http://localhost:4040/vehiculo/13

*********************************************************************************************************************************

-------------------------------------------
CREAR PROVEEDOR
-------------------------------------------
Método: POST
URL: http://localhost:4040/proveedor
Body (JSON):
{
    "nombre": "Autopartes Medellín",
    "telefono": "6043214567",
    "email": "contacto@autopartesmedellin.com",
    "direccion": "Cra 45 #50-23, Medellín"
}

-------------------------------------------
OBTENER PROVEEDOR POR ID
-------------------------------------------
Método: GET
URL: http://localhost:4040/proveedor/1

-------------------------------------------
MODIFICAR PROVEEDOR
-------------------------------------------
Método: PUT
URL: http://localhost:4040/proveedor/1
Body (JSON):
{
    "nombre": "Autopartes Medellín S.A.S.",
    "telefono": "6049998877",
    "email": "ventas@autopartesmedellin.com",
    "direccion": "Av. Las Palmas #12-34, Medellín"
}

-------------------------------------------
ELIMINAR PROVEEDOR
-------------------------------------------
Método: DELETE
URL: http://localhost:4040/proveedor/1

*********************************************************************************************************************************

=== SERVICIO DE EMPLEADOS ===
Base URL: http://localhost:4040

--------------------------------------------
GET  /empleados
Descripción: Obtiene todos los empleados.
Ejemplo: http://localhost:4040/empleados

--------------------------------------------
GET  /empleado/<id>
Descripción: Obtiene un empleado por ID.
Ejemplo: http://localhost:4040/empleado/1

--------------------------------------------
POST http://localhost:4040/empleado
Descripción: Crea un nuevo empleado.
Body JSON:
{
    "nombre": "Carlos",
    "apellido": "Rojas",
    "cargo": "Mecánico",
    "telefono": "3104567890",
    "email": "carlos.rojas@empresa.com",
    "fecha_contratacion": "2024-10-10"
}

--------------------------------------------
PUT /empleado/<id>
Descripción: Modifica un empleado existente.
Ejemplo: http://localhost:4040/empleado/1
Body JSON:
{
    "nombre": "Carlos",
    "apellido": "Rojas",
    "cargo": "Supervisor",
    "telefono": "3104567890",
    "email": "carlos.rojas@empresa.com",
    "fecha_contratacion": "2024-10-10"
}

--------------------------------------------
DELETE /empleado/<id>
Descripción: Elimina un empleado por su ID.
Ejemplo: http://localhost:4040/empleado/1

*********************************************************************************************************************************
===============================
 SERVICIO: CLIENTE --PROBAR
===============================

--------------------------------
1) CREAR CLIENTE (POST)
URL:
http://localhost:4040/cliente

BODY (JSON):
{
    "nombre": "Felipe",
    "apellido": "Sanabria",
    "telefono": "3105551234",
    "email": "f.sg@example.com",
    "direccion": "Calle 45 #12-89"
}


--------------------------------
2) OBTENER CLIENTE (GET)
URL:
http://localhost:4040/cliente/4


--------------------------------
3) MODIFICAR CLIENTE (PUT)
URL:
http://localhost:4040/cliente/4

BODY (JSON):
{
  "ClienteID": 4,
  "telefono": "123456789",
  "direccion": "Calle 5555555"
}


--------------------------------
4) ELIMINAR CLIENTE (DELETE)
URL:
http://localhost:4040/cliente/5



===========================================
  SERVICIO HISTORIAL DE VEHÍCULOS
  Puerto: 4040
===========================================

-------------------------------------------
OBTENER HISTORIAL COMPLETO DE UN VEHÍCULO
-------------------------------------------

URL:
GET http://localhost:4040/historial/13


-------------------------------------------
OBTENER TODOS LOS HISTORIALES
-------------------------------------------

URL:
GET http://localhost:4040/historiales



===============================
 SERVICIO: ORDEN DE TRABAJO
 Puerto: 4040
===============================


=========================================
CREAR ORDEN DE TRABAJO
=========================================

POST http://localhost:4040/orden
Content-Type: application/json

{
    "cita_id": 1,
    "empleado_id": 3,
    "observaciones": "Revisión general y diagnóstico inicial"
}



=========================================
OBTENER ORDEN COMPLETA POR ID
=========================================

GET http://localhost:4040/orden/3



=========================================
FINALIZAR ORDEN DE TRABAJO
=========================================

PUT http://localhost:4040/orden/3/finalizar
Content-Type: application/json

{
    "observaciones": "Orden finalizada correctamente. Se realizaron ajustes y pruebas."
}


******************************************************************************************************************
===========================================
  SERVICIO DETALLE ORDEN
  Puerto: 4040
===========================================

=========================================
INSERTAR MANO DE OBRA A ORDEN DE TRABAJO
=========================================

URL: http://localhost:4040/orden/1/mano_obra

{
    "descripcion": "Ajuste y calibración del sistema de frenos",
    "horas": 2.5,
    "costo": 150000
}

=========================================
INSERTAR REPUESTO A ORDEN DE TRABAJO
=========================================

URL: http://localhost:4040/orden/1/repuesto

{
    "repuesto_id": 4,
    "cantidad": 2
}



=========================================
INSERTAR SERVICIO A ORDEN DE TRABAJO
=========================================

URL: http://localhost:4040/orden/1/servicio

{
    "servicio_id": 2,
    "cantidad": 1
}

=========================================
LISTAR MANO DE OBRA
=========================================
GET

http://localhost:4040/orden/1/mano_obra

=========================================
LISTAR REPUESTOS
=========================================
GET

http://localhost:4040/orden/1/repuesto

=========================================
LISTAR SERVICIOS
=========================================
GET

http://localhost:4040/orden/1/servicio

=========================================
ACTUALIZAR MANO DE OBRA
=========================================
PUT

http://localhost:4040/orden/detalle/mano_obra/1

{
    "descripcion": "Cambio de banda y ajuste",
    "horas": 2,
    "costo": 60000
}

=========================================
ELIMINAR CUALQUIER DETALLE 
=========================================
DELETE

http://localhost:4040/orden/detalle/5



***************************************************************************************************************************************
=========================================
TOKENIZACIÓN
=========================================

En las terminal se deben ejecutar los siguientes comandos:


$env:AES_SECRET_KEY="12345678901234567890123456789012"

$env:JWT_SECRET_KEY="supersecreto_jwt_123"

python Seguridad/servicios_generador_token.py

y luego:


Levantar el servicio: python Seguridad/servicios_generador_token.py

Para generar el token, por medio del metodo POST: http://localhost:4040/token/generar
Utilizando el Json
{
  "usuario_id": 1,
  "rol": "admin",
  "cliente_id": 10,
  "id_sucursal": 3
}

Token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c3VhcmlvX2lkIjoiVGdaTG9nMk1wa1czbi9FZ0FjQnY5Tlc4NythRkVXWlZ1M1FFaUJaY0pkbz0iLCJyb2wiOiJWRDlwYy9nMEMzaXNpMnF5VUsvK1c0S0tKZWRlYys4VUwwbTZVZDVScldNPSIsImV4cCI6MTc2Mzg2MTM4NX0.X6WaFsfpQxco9qgwniYSyKt3GL7zYcldIO-qWsFLNp8

eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c3VhcmlvX2lkIjoiTUZvYmM5NXRpZ3U3aHhZL3p2WmMxVnJGcFVyN1dHUE05L0pMbDd5SzlIaz0iLCJyb2wiOiJxemV2QTRyV1FKRVY1anFydThCS3FhRnZwY2dKOUNVVW1EeE0ranc1ZnJnPSIsImNsaWVudGVfaWQiOiJ2bCtEYmV1c1UrU0ZEaWtEekd5VjB5WUFtRmwxMmo4VHVUWEFOUS9wU3c0PSIsImlkX3N1Y3Vyc2FsIjoiVkJyUW1pMzQ3T0RTY2l2UkFkZ1hvRFFoZ1Bhci9pUHUwcTA2NEpwb3hmWT0iLCJleHAiOjE3NjM4Nzg0Njh9.ZZtDvQkwm2VgXzkMZjPAWOT23TJV18RzqfrNm2srUPk

Para probar la tokenización se debe de agregar al Thunder Client dos parametros (Headers)
Authorization: Bearer <token-generado>
Content-Type: application/json